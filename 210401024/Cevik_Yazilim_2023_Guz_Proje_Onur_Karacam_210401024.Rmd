---
title: "Proje Rapor : Onur Karaçam 210401024"
output:
  html_document:
    df_print: paged
---

# Q1 : Problem tanımı

Honorad Studio, reklam ajansı olarak, New York'ta üç şubesine *(Lower Manhattan, Hell's Kitchen, Astoria)* sahip olan **Maven Roasters**'ın bize başvurması üzerine, tasarımlarıyla birlikte hazırlayacağımız dış mekan tabelası ve saat aralıklarına uygun düzenleyeceğimiz kampanyalar aracılığıyla az satan ürünlerin satışını artırarak müşteri portföyünü genişletmeyi amaçlıyoruz.

# Q2 : Proje Amacı
[Coffee Shop Sales](https://www.kaggle.com/datasets/ahmedabbas757/coffee-sales/data) adli Kaggle veri setini kullanarak iş problemini **her bir şubeye ve *SAAT* aralığına özel olarak belirlediğimiz en az ilgi gören ürünü, "_BAZI YILDIZLAR VARDIR; KEŞFEDİLMEYİ BEKLEYEN_"** sloganıyla birlikte **fazla ilgi duyan ürünlerin yanında konumlandırarak öne çıkarmayı ve "_5 YILDIZI TAMAMLA VE GÜNEŞİN BİZDEN OLSUN_" kampanyasıyla daimi müşteri kazanmayı amaçlıyoruz.** Bu sayede şans verilmeyen ürünlerimizi tanıtlamakla birlikte işletmenin müşteri kitlesini çeşitlendirmeyi, yeni müşteri segmentlerine ulaşmayı ve daha fazla satış yapmayı planlıyoruz.

# Q3 : Veri seti keşifsel analizi

```{r echo=FALSE, message=FALSE, warning=FALSE}
#Veri setini içeri aktarıyoruz.
filename <- "Coffee Shop Sales.csv"

# Veri setini bir data.frame olarak ithal ediyoruz.
library(readr)
data <- read_csv(filename)
```

Veri seti Kaggle web sitesinden indirilmiştir ve **readr::read_csv()** fonksiyonu kullanılarak **`r class(data)[[1]]`** tipinde bir değişkene ithal edilmiştir. Veri boyutları aşağıdaki gibidir :

- **Satir sayisi : `r nrow(data)`**
- **Sütun sayisi : `r ncol(data)`**

Veri setinin ön görsellemesi aşağıda verilmiştir.

```{r echo=FALSE, message=FALSE, warning=FALSE}
data
```

- Veri setini incelediğimizde, problem çözümü için kullanacağımız sütunlardan **transaction_date** sütununun *character* tipinde geldiğini ve bunun *POSIXct* tipine dönüştürülmesi gerektiğini görüyoruz.

- Veri setimizdeki **NA Veri sayisi : `r sum(is.na(data))`** olduğundan verilerin temiz ve kayıpsız olduğunu görüyoruz.

-  Reklam çalışmamızda tatlandırıcı **(Flavours)**, kahve çekirdekleri **(Coffee beans)**, paketli çikolotalar **(Packaged Chocolate)**  ve markanın ürünleri **(Branded)** dahil edilmeyeceğinden dolayı veri setimizden bu ürünleri sileceğiz.

- Diğer sütunlardaki değişkenlere ihtiyaç duymayacağımızdan onları sileceğiz.
    + transaction_id, store_id, product_id, product_category, product_type
    

- **unit_price** sütununa tasarım kısmında ihtiyacımız olacağı için tutuyoruz.     

- Veri setimizdeki **transaction_time** sütununun *time* tipinde olması saat aralığı seçmemizde bize yardımcı olacak. 

- Veri setimizde tüm şubelerin verileri iç içe bulunduğu ve her bir şube için farklı reklam stratejileri geliştireceğimiz için şubeleri ayrı ayrı *data.frame*'lere atayacağız.



```{r echo=FALSE, message=FALSE, warning=FALSE}
library(dplyr)
data$transaction_date <- as.POSIXct(data$transaction_date, format = "%m/%d/%Y")

data <- data %>%
  filter(!(product_category %in% c("Flavours", "Coffee beans", "Branded", "Packaged Chocolate")))

data <- select(data, -c(transaction_id, store_id, product_id,product_type))


#farkli_deger_sayisi <- length(unique(data$store_location))
#farkli_deger_sayisi


Lower_Manhattan <- data %>% filter(store_location == "Lower Manhattan")
Astoria <- data %>% filter(store_location == "Astoria")
Hells_Kitchen <- data %>% filter(store_location == "Hell's Kitchen")

```
<hr style="border:2px solid gray">
    
```{r echo=FALSE, message=FALSE, warning=FALSE}
library(gridExtra)
library(ggplot2)

Lower_Manhattan_category_sales <- ggplot(data, aes(x = product_category, y = transaction_qty, fill = product_category)) +
  geom_bar(stat = "identity") +
  labs(title = "Ürün Satışları - Tüm Şubeler", x = "Ürün Kategorisi", y = "Satış Miktarı") +
  theme_minimal()

Astoria_sales <- ggplot(Astoria, aes(x = product_detail, y = transaction_qty)) +
  geom_bar(stat = "identity", fill = "skyblue") +
  labs(title = "Ürün Satışları - Astoria", x = "Ürün Detayı (product_detail)", y = "Satış Miktarı") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1, size = 5))

grid.arrange(Lower_Manhattan_category_sales, Astoria_sales, ncol = 1)

alt_500 <- subset(Astoria, transaction_qty < 500)

```
   
##### Yukarıdaki iki grafikte de görüldüğü üzere **Loose Tea** kategorisindeki ürünlerim diğer kategorideki ürünlere göre açık ara daha az tercih edildiğini görüyoruz. Reklamlarımızda insanları **Loose Tea** kategorisindeki ürünleri satın almasına teşfik etmemiz gerektiği çıkarımını yapıyoruz. Ancak **projemizin amacı gün içerisindeki saat aralıklarında yapılan satışlara göre az tercih edilen ürüne teşviği artırmak** olduğundan **Loose Tea** kategorisindeki ürünlerin reklamını **Maven Roastery**nin isteğine göre *farklı* bir projede yapacağız.


```{r echo=FALSE, message=FALSE, warning=FALSE}


toplam_satis_sayisi_Lower_Manhattan <- sum(Lower_Manhattan$transaction_qty)
toplam_satis_sayisi_Astoria <- sum(Astoria$transaction_qty)
toplam_satis_sayisi_Hells_Kitchen <- sum(Hells_Kitchen$transaction_qty)
```

<br> </br>

#### **Şubelerin Tekel Verileri**
Store Location   | Data of Days | Data of Times | Categories | Products | Total Sales
:---:  |:---:|:---:|:---:|:---:|:---:|:---:|:---:|
Lower Manhattan | `r length(unique(Lower_Manhattan$transaction_date))`| `r length(unique(Lower_Manhattan$transaction_time))`| `r length(unique(Lower_Manhattan$product_category))` | `r length(unique(Lower_Manhattan$product_detail))`| `r format(toplam_satis_sayisi_Lower_Manhattan, scientific = FALSE)`
Astoria | `r length(unique(Astoria$transaction_date))`| `r length(unique(Astoria$transaction_time))`| `r length(unique(Astoria$product_category))` | `r length(unique(Astoria$product_detail))`| `r format(toplam_satis_sayisi_Astoria, scientific = FALSE)`
Hell's Kitchen | `r length(unique(Hells_Kitchen$transaction_date))`| `r length(unique(Hells_Kitchen$transaction_time))`| `r length(unique(Hells_Kitchen$product_category))` | `r length(unique(Hells_Kitchen$product_detail))`| `r format(toplam_satis_sayisi_Hells_Kitchen, scientific = FALSE)`

<hr style="border:2px solid gray">
# Q4 : Veri seti ön işlemesi

- Q3'teki değişiklere göre 
    - **Satir sayisi : `r nrow(data)`**
    - **Sütun sayisi : `r ncol(data)`**
    
    
- Demomuzda yukarıda edindiğimiz verilere göre en çok satış yapan **Astoria** şubesinin 1 haftalık *(2023-01-01 - 2023-01-08)* verilerini ele alacağız ve üzerinde çalışacağız. Aşağıdaki tabloda **Astoria** şubesinin **1 Ocak 2023** tarihi ile **8 Ocak 2023** tarihleri arasında yapmış olduğu satışları görüyoruz.

```{r echo=FALSE, message=FALSE, warning=FALSE}

Astoria_Datas <- Astoria %>%
  filter(format(transaction_date, "%Y-%m-%d") >= "2023-01-01" & format(transaction_date,, "%Y-%m-%d") <= "2023-01-08")

toplam_satis_sayisi_Astoria <- sum(Astoria_Datas$transaction_qty)
Astoria_Datas_Revenue <- sum(Astoria_Datas$unit_price)
Astoria_Datas

```
#### **Astoria** şubesinin **2023-01-01 - 2023-01-08** tarihinde yapmış olduğu satışlar:
Store Location | Data of Days | Data of Times | Categories | Products | Total Sales | Revenue
:---:  |:---:|:---:|:---:|:---:|:---:|:---: |
Astoria | `r length(unique(Astoria_Datas$transaction_date))`| `r length(unique(Astoria_Datas$transaction_time))`| `r length(unique(Astoria_Datas$product_category))` | `r length(unique(Astoria_Datas$product_detail))`| `r format(toplam_satis_sayisi_Astoria, scientific = FALSE)`| `r format(Astoria_Datas_Revenue, scientific = FALSE)`
- Aşağıdaki grafikte örnek olarak aldığımız 2023-01-01 tarihinden saat 11:00:00 - 12:00:00 arasında yapılmış olan satışları görüyoruz.
<br> </br>
```{r echo=FALSE, message=FALSE, warning=FALSE}
zaman_araligi1 <- Astoria %>%
  filter(format(transaction_date, "%Y-%m-%d") == "2023-01-06") %>%
  filter(format(transaction_time, "%H:%M:%S") >= "12:00:00" & format(transaction_time, "%H:%M:%S") <= "13:00:00")

ggplot(zaman_araligi1, aes(x = product_category, y = transaction_qty, fill = product_category)) +
  geom_bar(stat = "identity") +
  labs(title = "Ürün Satışları - Astoria", x = "Ürün Kategorisi (product_category)", y = "Satış Miktarı") +
  theme_minimal()

ggplot(zaman_araligi1, aes(x = product_detail, y = transaction_qty)) +
  geom_bar(stat = "identity", fill = "skyblue") +
  labs(title = "Ürün Satışları - Astoria", x = "Ürün Detayı (product_detail)", y = "Satış Miktarı") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))
```

<hr style="border:2px solid gray">

# Q5 : Veri mühendisliği 

- Daha çok veriyle daha doğru sonuçlar elde edeceğimiz için **Astoria** şubesinde en çok satış yapılan günü bulup o veriler üzerinde ilk demomuzu gerçekleştireceğiz.

#### Aşağıdaki tabloda **Astoria** şubesinin satışlarının en çok olduğu 10 günü görüyoruz.

```{r echo=FALSE, message=FALSE, warning=FALSE}
library(kableExtra)

toplam_transaction_qty <- Astoria %>%
  group_by(transaction_date) %>%
  summarise(toplam_qty = sum(transaction_qty))

toplam_transaction_qty_sirali <- toplam_transaction_qty %>%
  arrange(desc(toplam_qty)) %>%
  top_n(10)

toplam_transaction_qty_sirali %>%
  kable("html", escape = F) %>%
  kable_styling(
    bootstrap_options = c("striped", "hover", "condensed", "bordered", "cell_borders", "full_width"), 
    position = "center"
  ) %>%
  column_spec(1, width = "10cm") %>%
  column_spec(2, width = "10cm") %>%
  row_spec(0, bold = TRUE) %>%
  row_spec(which.max(toplam_transaction_qty_sirali$toplam_qty) + 0, background = "lightgreen")

```
<br> </br>


```{r echo=FALSE, message=FALSE, warning=FALSE}
zaman_araligi2 <- Astoria %>%
  filter(format(transaction_date, "%Y-%m-%d") == "2023-06-24")

toplam_satis_sayisi_Astoria <- sum(zaman_araligi2$transaction_qty)
```


### Aşağıdaki tabloda **Astoria** şubesinin **`r unique(zaman_araligi2$transaction_date)`** tarihindeki tüm verilerini görüyoruz.


```{r echo=FALSE, message=FALSE, warning=FALSE}
zaman_araligi2
```


```{r echo=FALSE, message=FALSE, warning=FALSE}


zaman_araligi2_categoryes <- ggplot(zaman_araligi2, aes(x = product_category, y = transaction_qty, fill = product_category)) +
  geom_bar(stat = "identity") +
  labs(title = "Ürün Satışları - Astoria - 2023-06-24", x = "Ürün Kategorisi (product_category)", y = "Satış Miktarı") +
  theme_minimal()

zaman_araligi2_sales <- ggplot(zaman_araligi2, aes(x = product_detail, y = transaction_qty)) +
  geom_bar(stat = "identity", fill = "skyblue") +
  labs(title = "Ürün Satışları - Astoria - 2023-06-24", x = "Ürün Detayı (product_detail)", y = "Satış Miktarı") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1, size = 5))

grid.arrange(zaman_araligi2_categoryes, zaman_araligi2_sales, ncol = 1.5)
```

Store Location | Day | Data of Times | Categories | Products | Total Sales |
:---:  |:---:|:---:|:---:|:---:|:---:|
Astoria | `r unique(zaman_araligi2$transaction_date)` | `r length(unique(zaman_araligi2$transaction_time))`| `r length(unique(zaman_araligi2$product_category))` | `r length(unique(zaman_araligi2$product_detail))`| `r format(toplam_satis_sayisi_Astoria, scientific = FALSE)`| `r format(Astoria_Datas_Revenue, scientific = FALSE)`

